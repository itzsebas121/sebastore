README - Uso de Procedimientos Almacenados (Stored Procedures)
Tabla de Contenidos
IntroducciÃ³n

IntroducciÃ³n
Este documento describe cÃ³mo usar los procedimientos almacenados GetCategories y GetProducts para consultar categorÃ­as y productos de la base de datos.

Los procedimientos estÃ¡n diseÃ±ados para facilitar la paginaciÃ³n y el filtrado eficiente de productos, permitiendo manejar grandes volÃºmenes de datos sin afectar el rendimiento.

Procedimientos disponibles
Procedimiento	DescripciÃ³n
GetCategories	Retorna todas las categorÃ­as ordenadas por nombre.
GetProducts	Retorna productos filtrados, paginados y con conteo total.

Ejecutar GetCategories
sql
Copiar
Editar
EXEC GetCategories;
Retorna un listado con todas las categorÃ­as disponibles.

Ãštil para mostrar filtros o menÃºs en la interfaz de usuario.

Ejecutar GetProducts
sql
Copiar
Editar
EXEC GetProducts
    @NameFilter = NULL,
    @CategoryId = NULL,
    @MinPrice = NULL,
    @MaxPrice = NULL,
    @PageNumber = 1,
    @PageSize = 20;
Retorna dos resultados:

TotalCount: nÃºmero total de productos que cumplen los filtros.

Lista paginada de productos segÃºn la pÃ¡gina y tamaÃ±o especificado.

ParÃ¡metros de GetProducts
ParÃ¡metro	Tipo	DescripciÃ³n	Valor por defecto
@NameFilter	NVARCHAR(100)	Filtro parcial por nombre de producto (uso de LIKE %...%)	NULL
@CategoryId	INT	Filtra productos por categorÃ­a especÃ­fica	NULL
@MinPrice	DECIMAL(10, 2)	Precio mÃ­nimo del producto	NULL
@MaxPrice	DECIMAL(10, 2)	Precio mÃ¡ximo del producto	NULL
@PageNumber	INT	NÃºmero de pÃ¡gina para paginaciÃ³n (comienza en 1)	1
@PageSize	INT	Cantidad de productos a devolver por pÃ¡gina	20

Ejemplos de uso
1. Obtener todas las categorÃ­as
sql
Copiar
Editar
EXEC GetCategories;
2. Obtener los primeros 20 productos sin filtros
sql
Copiar
Editar
EXEC GetProducts;
3. Buscar productos que contengan â€œnetflixâ€
sql
Copiar
Editar
EXEC GetProducts @NameFilter = 'netflix';
4. Obtener productos de categorÃ­a 1 (Streaming), pÃ¡gina 2, 10 por pÃ¡gina
sql
Copiar
Editar
EXEC GetProducts @CategoryId = 1, @PageNumber = 2, @PageSize = 10;
5. Filtrar por rango de precios entre 2.00 y 5.00
sql
Copiar
Editar
EXEC GetProducts @MinPrice = 2.00, @MaxPrice = 5.00;
6. Aplicar todos los filtros juntos
sql
Copiar
Editar
EXEC GetProducts 
    @NameFilter = 'netflix',
    @CategoryId = 1,
    @MinPrice = 2.00,
    @MaxPrice = 6.00,
    @PageNumber = 1,
    @PageSize = 20;
Notas importantes
Los parÃ¡metros son opcionales; los que no se proporcionen o sean NULL no afectarÃ¡n el filtro.

La paginaciÃ³n permite manejar grandes cantidades de productos eficientemente.

Se recomienda manejar la respuesta de dos conjuntos de resultados (TotalCount y lista de productos) en la capa de aplicaciÃ³n para mostrar total de pÃ¡ginas y resultados actuales.






EXEC CreateCustomer
    @Email = 'sebastipan@example.com',
    @Password = 'MiPass123!',
    @FirstName = 'Sebas',
    @LastName = 'Tipan',
    @Phone = '0998765432';
ğŸ“¥ ParÃ¡metros requeridos:
ParÃ¡metro	Tipo	DescripciÃ³n
@Email	NVARCHAR(100)	Email del cliente (debe ser vÃ¡lido y Ãºnico).
@Password	NVARCHAR(100)	ContraseÃ±a en texto plano (se encripta).
@FirstName	NVARCHAR(100)	Nombres del cliente (solo letras/espacios).
@LastName	NVARCHAR(100)	Apellidos del cliente (solo letras/espacios).
@Phone	NVARCHAR(20)	TelÃ©fono vÃ¡lido de Ecuador.

ğŸ“¤ Salidas:
âœ”ï¸ Ã‰xito:
sql
Copiar
Editar
SELECT 'Customer successfully created' AS message, CustomerId;
âŒ Posibles errores:
sql

SELECT 'Invalid characters in FirstName' AS error;
SELECT 'Invalid characters in LastName' AS error;
SELECT 'Invalid email format' AS error;
SELECT 'Email already registered' AS error;
SELECT 'Invalid Ecuadorian phone number' AS error;
SELECT 'Error tÃ©cnico interno (mensaje del sistema)' AS error;




EXEC LoginUser
    @Email = 'admin@example.com',
    @Password = 'Admin123!';

Este procedimiento permite iniciar sesiÃ³n validando las credenciales de un usuario. Si las credenciales son correctas, devuelve el UserId, el Role, y dependiendo del rol, el AdminId o el CustomerId.

ğŸ“¥ ParÃ¡metros de entrada:
Nombre	Tipo de dato	DescripciÃ³n
@Email	NVARCHAR(100)	Correo electrÃ³nico del usuario.
@Password	NVARCHAR(100)	ContraseÃ±a en texto plano.

âŒ Posibles salidas de error (como SELECT):
Campo	Valor	DescripciÃ³n
error	"Email not registered"	El correo no existe en la base de datos.
error	"Incorrect credentials"	ContraseÃ±a incorrecta.
error	ERROR_MESSAGE() (de SQL Server)	Error inesperado en la ejecuciÃ³n.

âœ… Salida en caso de Ã©xito (como SELECT):
Campo	Tipo	DescripciÃ³n
UserId	INT	Identificador Ãºnico del usuario.
Role	NVARCHAR	Rol del usuario (Admin o Customer).
AdminId	INT	Solo si el usuario es admin, caso contrario NULL.
CustomerId	INT	Solo si el usuario es cliente, caso contrario NULL.


ğŸ“¦ AddProductToCart
âœ… PropÃ³sito
Agrega un producto al carrito activo del cliente. Si el cliente no tiene un carrito activo, se crea uno nuevo.

ğŸ”§ ParÃ¡metros
ParÃ¡metro	Tipo	DescripciÃ³n
@CustomerId	INT	ID del cliente (CustomerId)
@ProductId	INT	ID del producto a agregar
@Quantity	INT	Cantidad del producto a agregar (> 0)

ğŸ“¤ Salidas
Ã‰xito:

Campo	Valor
message	'Producto actualizado en el carrito existente.'
'Producto agregado al carrito.'

Error:

Campo	Valor
error	'La cantidad debe ser mayor a cero.'
'Producto no encontrado.'

ğŸ§ª Ejemplo de uso
sql
Copiar
Editar
EXEC AddProductToCart @CustomerId = 2, @ProductId = 5, @Quantity = 1;
ğŸ›  UpdateCartItem
âœ… PropÃ³sito
Actualiza la cantidad de un producto existente en el carrito activo del cliente.

ğŸ”§ ParÃ¡metros
ParÃ¡metro	Tipo	DescripciÃ³n
@CustomerId	INT	ID del cliente (CustomerId)
@ProductId	INT	ID del producto a actualizar
@Quantity	INT	Nueva cantidad (> 0)

ğŸ“¤ Salidas
Ã‰xito:

Campo	Valor
message	'Cantidad del producto actualizada correctamente.'

Error:

Campo	Valor
error	'La cantidad debe ser mayor a cero.'
'No se encontrÃ³ un carrito activo para este cliente.'
'El producto no se encuentra en el carrito.'

ğŸ§ª Ejemplo de uso
sql
Copiar
Editar
EXEC UpdateCartItem @CustomerId = 2, @ProductId = 5, @Quantity = 3;
âŒ RemoveProductFromCart
âœ… PropÃ³sito
Elimina un producto especÃ­fico del carrito activo del cliente.

ğŸ”§ ParÃ¡metros
ParÃ¡metro	Tipo	DescripciÃ³n
@CustomerId	INT	ID del cliente (CustomerId)
@ProductId	INT	ID del producto a eliminar del carrito

ğŸ“¤ Salidas
Ã‰xito:

Campo	Valor
message	'Producto eliminado del carrito correctamente.'

Error:

Campo	Valor
error	'No se encontrÃ³ un carrito activo para este cliente.'
'El producto no se encuentra en el carrito.'

ğŸ§ª Ejemplo de uso
sql
Copiar
Editar
EXEC RemoveProductFromCart @CustomerId = 2, @ProductId = 5;